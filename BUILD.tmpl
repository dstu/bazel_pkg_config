# vi: ft=bzl
package(default_visibility = ["//visibility:private"])

_imports = [p[:len(p)-2] for p in glob(["{}/**/*.a".format(d) for d in [%{deps}]])]
[cc_import(
    name = i.replace("/", "_"),
    hdrs = glob(["include/**/*.h"]),
    # TODO: library extension for platform.
    static_library = "{}.a".format(i),
    shared_library = "{}.dylib".format(i),
) for i in _imports]

cc_library(
    name = "internal_lib",
    hdrs = glob(["include/**/*.h"]),
    copts = [%{copts}],
    includes = ["include"],
    linkopts = [%{linkopts}],
    deps = [(":" + i.replace("/", "_")) for i in _imports],
    visibility = ["//visibility:public"],
)

cc_library(
    name = "lib",
    hdrs = glob(["include/**/*.h"]),
    copts = [%{extra_copts}],
    includes = ["include"],
    linkopts = [%{extra_linkopts}],
    deps = [":internal_lib"] + [%{extra_deps}],
    visibility = ["//visibility:public"],
    strip_include_prefix = "include",
    include_prefix = "%{include_prefix}",
)
